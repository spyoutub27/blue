<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>정책 이해도 퀴즈</title>
<style>
:root{
  color-scheme:dark;
  --bg:#040814;
  --surface:rgba(15,22,48,0.78);
  --surface-solid:#101a3c;
  --border:rgba(126,156,255,0.18);
  --accent:#7aa4ff;
  --accent-strong:#3c6cff;
  --text:#eef3ff;
  --muted:#96a4c7;
  --success:#1ed47e;
  --danger:#ff6b6b;
  --radius:20px;
}
*{box-sizing:border-box;}
body{
  margin:0;
  min-height:100vh;
  font-family:'Pretendard','Noto Sans KR','Segoe UI',Roboto,system-ui,sans-serif;
  color:var(--text);
  background:radial-gradient(1200px 800px at 10% -12%,rgba(122,164,255,0.16),transparent),var(--bg);
  position:relative;
}
body::before{
  content:'';
  position:fixed;
  inset:0;
  background:radial-gradient(900px 600px at 80% 0%,rgba(60,108,255,0.2),transparent);
  opacity:0.6;
  pointer-events:none;
}
button{font-family:inherit;}
.top{
  position:sticky;
  top:0;
  z-index:10;
  display:flex;
  justify-content:space-between;
  align-items:flex-start;
  gap:24px;
  padding:28px clamp(20px,4vw,40px);
  backdrop-filter:saturate(140%) blur(12px);
  background:linear-gradient(90deg,rgba(8,14,30,0.92),rgba(8,14,30,0.72));
  border-bottom:1px solid rgba(255,255,255,0.06);
}
.top__left{display:flex;flex-direction:column;gap:8px;max-width:540px;}
.eyebrow{font-size:12px;letter-spacing:0.2em;text-transform:uppercase;color:var(--muted);}
.top__left h1{margin:0;font-size:clamp(28px,4vw,38px);font-weight:700;}
.subtitle{margin:0;color:var(--muted);font-size:15px;line-height:1.5;}
.mode{margin-top:4px;align-self:flex-start;padding:6px 12px;border-radius:999px;background:rgba(122,164,255,0.12);color:var(--accent);font-size:13px;font-weight:600;letter-spacing:0.02em;}
.mode.review{background:rgba(30,212,126,0.18);color:var(--success);}
.top__right{display:flex;align-items:center;gap:18px;}
.radial{position:relative;width:112px;height:112px;display:flex;align-items:center;justify-content:center;}
.ring{position:absolute;width:100%;height:100%;transform:rotate(-90deg);}
.ring__bg{fill:none;stroke:rgba(122,164,255,0.18);stroke-width:10;}
.ring__fg{fill:none;stroke:var(--accent);stroke-width:10;stroke-linecap:round;transition:stroke-dashoffset .35s ease;}
.radial__label{position:relative;text-align:center;display:flex;flex-direction:column;gap:2px;font-size:13px;color:var(--muted);}
.radial__label strong{font-size:28px;color:var(--text);line-height:1;}
.radial__label em{font-style:normal;font-size:12px;color:var(--muted);}
.score-card{min-width:150px;padding:16px 20px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);display:flex;flex-direction:column;gap:6px;box-shadow:0 20px 60px rgba(0,0,0,0.35);}
.score-card span{font-size:13px;color:var(--muted);}
.score-card strong{font-size:28px;}
.layout{
  display:grid;
  grid-template-columns:minmax(0,2fr) minmax(0,1fr);
  gap:24px;
  padding:24px clamp(20px,4vw,40px) 48px;
}
.panel{
  background:var(--surface);
  border:1px solid var(--border);
  border-radius:var(--radius);
  padding:28px;
  box-shadow:0 24px 80px rgba(5,9,18,0.55);
  position:relative;
}
.quiz{display:flex;flex-direction:column;gap:24px;min-height:420px;}
.quiz__meta{display:flex;flex-direction:column;gap:10px;}
.muted{color:var(--muted);}
.progress{height:6px;background:rgba(122,164,255,0.12);border-radius:999px;overflow:hidden;}
.progress__fill{height:100%;width:0%;background:linear-gradient(90deg,var(--accent),var(--accent-strong));transition:width .4s ease;}
.quiz__question{margin:0;font-size:clamp(20px,3vw,26px);line-height:1.45;}
.quiz__options{display:grid;gap:12px;}
.choice{
  display:flex;
  align-items:center;
  gap:16px;
  padding:16px 18px;
  border-radius:16px;
  background:rgba(9,17,38,0.65);
  border:1px solid rgba(122,164,255,0.18);
  color:inherit;
  font-size:16px;
  line-height:1.5;
  cursor:pointer;
  transition:border-color .25s ease, transform .25s ease, background .25s ease;
}
.choice__index{
  width:32px;
  height:32px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  background:rgba(122,164,255,0.18);
  color:var(--accent);
  font-weight:600;
}
.choice__text{flex:1;text-align:left;}
.choice:hover{border-color:rgba(122,164,255,0.45);transform:translateY(-1px);}
.choice:focus-visible{outline:2px solid var(--accent);outline-offset:3px;}
.choice.selected{border-color:var(--accent);background:rgba(122,164,255,0.18);}
.choice.correct{border-color:rgba(30,212,126,0.7);background:rgba(12,40,32,0.85);}
.choice.wrong{border-color:rgba(255,107,107,0.7);background:rgba(52,20,32,0.75);}
.choice[disabled]{opacity:.85;cursor:default;transform:none;}
.quiz__explain{border-radius:16px;background:rgba(10,24,52,0.75);border:1px solid rgba(122,164,255,0.14);padding:18px;display:flex;flex-direction:column;gap:6px;min-height:96px;opacity:0;visibility:hidden;pointer-events:none;transition:opacity .25s ease;}
.quiz__explain.visible{opacity:1;visibility:visible;pointer-events:auto;}

.quiz__label{text-transform:uppercase;font-size:12px;letter-spacing:0.16em;color:var(--muted);}
.quiz__explain p{margin:0;font-size:15px;line-height:1.6;}
.quiz__foot{display:flex;justify-content:space-between;align-items:center;font-size:14px;color:var(--muted);}
.quiz__foot strong{font-size:18px;color:var(--text);}
.quiz__actions{display:flex;gap:12px;justify-content:flex-end;}
.pill{
  cursor:pointer;
  font-size:15px;
  font-weight:600;
  padding:12px 18px;
  border-radius:999px;
  border:1px solid rgba(122,164,255,0.2);
  background:rgba(9,17,38,0.75);
  color:var(--text);
  transition:background .25s ease, border-color .25s ease, transform .25s ease;
}
.pill:hover{transform:translateY(-1px);border-color:rgba(122,164,255,0.45);}
.pill:focus-visible{outline:2px solid var(--accent);outline-offset:3px;}
.pill.primary{background:linear-gradient(135deg,var(--accent),var(--accent-strong));border-color:transparent;color:#080f21;}
.pill.primary:hover{filter:brightness(1.05);}
.pill.ghost{background:transparent;}
.pill[disabled]{opacity:.45;cursor:not-allowed;transform:none;}
.guide h2{margin:0 0 16px;font-size:20px;}
.guide__list{margin:0 0 24px;padding-left:20px;display:grid;gap:10px;font-size:15px;color:var(--muted);}
.guide__list li{line-height:1.55;}
.note{background:rgba(9,17,38,0.55);border:1px solid rgba(122,164,255,0.12);border-radius:16px;padding:18px;}
.note h3{margin:0 0 8px;font-size:16px;}
.note p{margin:0;font-size:14px;color:var(--muted);line-height:1.6;}
.result{grid-column:1/-1;display:flex;flex-direction:column;gap:24px;}
.result__header h2{margin:0;font-size:24px;}
.result__header p{margin:4px 0 0;color:var(--muted);}
.result__stats{display:flex;gap:20px;flex-wrap:wrap;}
.result__stats div{flex:1 1 180px;background:rgba(9,17,38,0.55);border:1px solid rgba(122,164,255,0.12);border-radius:16px;padding:18px;display:flex;flex-direction:column;gap:6px;}
.result__stats strong{font-size:28px;}
.result__table{overflow:auto;max-height:340px;border-radius:16px;}
.result__table table{width:100%;border-collapse:collapse;font-size:14px;min-width:520px;}
.result__table th,.result__table td{border:1px solid rgba(255,255,255,0.08);padding:10px 12px;text-align:left;}
.result__table tbody tr.correct{background:rgba(12,40,32,0.45);}
.result__table tbody tr.wrong{background:rgba(52,20,32,0.45);}
.result__actions{display:flex;gap:12px;justify-content:flex-end;}
.overlay{
  position:fixed;
  inset:0;
  background:rgba(4,8,20,0.88);
  backdrop-filter:blur(18px);
  display:flex;
  align-items:center;
  justify-content:center;
  z-index:20;
}
.overlay[hidden]{display:none;}
.intro{width:min(620px,calc(100vw - 64px));max-width:620px;min-width:min(540px,calc(100vw - 64px));text-align:center;background:var(--surface);border:1px solid var(--border);padding:40px 48px;border-radius:28px;display:flex;flex-direction:column;gap:20px;box-shadow:0 24px 80px rgba(5,9,18,0.65);} 
.intro h2{margin:0;font-size:clamp(24px,3.4vw,34px);white-space:nowrap;word-break:keep-all;letter-spacing:-0.01em;}
.intro p{margin:0;color:var(--muted);line-height:1.6;font-size:15px;}
.intro__start{align-self:center;padding-inline:28px;}
@media (max-width:640px){
  .intro{width:calc(100vw - 40px);min-width:0;padding:32px 24px;border-radius:24px;gap:16px;}
  .intro h2{white-space:normal;font-size:24px;}
}
@media (max-width:1024px){
  .layout{grid-template-columns:1fr;grid-auto-rows:auto;}
  .guide{order:3;}
  .result{order:4;}
  .top{position:static;}
}
@media (max-width:720px){
  .top{flex-direction:column;align-items:flex-start;}
  .top__right{width:100%;justify-content:space-between;}
  .layout{padding-bottom:36px;}
  .quiz__actions{flex-direction:column;}
  .score-card{min-width:0;width:100%;}
}
@media (prefers-reduced-motion:reduce){
  *,*::before,*::after{animation-duration:.01ms!important;animation-iteration-count:1!important;transition-duration:.01ms!important;scroll-behavior:auto!important;}
}
</style>
</head>
<body>
<header class="top">
  <div class="top__left">
    <span class="eyebrow">Policy Literacy</span>
    <h1>정책 이해도 퀴즈</h1>
    <p class="subtitle">디지털 행정과 공공데이터 활용에 대한 핵심 포인트를 빠르게 점검해 보세요.</p>
    <div class="mode" id="mode-badge">전체 모드</div>
  </div>
  <div class="top__right">
    <div class="radial">
      <svg class="ring" viewBox="0 0 120 120" aria-hidden="true">
        <circle class="ring__bg" cx="60" cy="60" r="52"></circle>
        <circle class="ring__fg" cx="60" cy="60" r="52" stroke-dasharray="327" stroke-dashoffset="0"></circle>
      </svg>
      <div class="radial__label">
        <span>남은 시간</span>
        <strong id="time">25</strong>
        <em>초</em>
      </div>
    </div>
    <div class="score-card">
      <span>획득 점수</span>
      <strong id="score">0</strong>
    </div>
  </div>
</header>
<main class="layout">
  <section class="panel quiz" id="stage" hidden>
    <div class="quiz__meta">
      <span class="muted" id="progress-text">문제 1 / 10</span>
      <div class="progress">
        <div class="progress__fill" id="progress-fill"></div>
      </div>
    </div>
    <h2 class="quiz__question" id="q">-</h2>
    <div class="quiz__options" id="opts"></div>
    <div class="quiz__explain" id="explain" aria-hidden="true">
      <span class="quiz__label">정답 해설</span>
      <p id="explain-text"></p>
    </div>
    <div class="quiz__foot">
      <span>문제 <strong id="idx">0</strong> / <span id="total">0</span></span>
      <span class="muted">객관식 4지선다 · 25초 제한</span>
    </div>
    <div class="quiz__actions">
      <button type="button" class="pill ghost" id="skip">건너뛰기</button>
      <button type="button" class="pill primary" id="next">정답 확인</button>
    </div>
  </section>
  <aside class="panel guide" id="guide">
    <h2>진행 가이드</h2>
    <ul class="guide__list">
      <li>각 문항마다 핵심 정책 개념을 짚어 드립니다.</li>
      <li>정답을 선택하면 해설과 정책 배경을 바로 확인할 수 있습니다.</li>
      <li>오답은 결과 화면에서 따로 복습할 수 있어요.</li>
    </ul>
    <div class="note">
      <h3>이 퀴즈를 활용하는 방법</h3>
      <p>간단한 사전 교육이나 워크숍 아이스브레이킹, 신규 직원 온보딩 등에 활용하면 정책 이해도를 빠르게 점검할 수 있습니다. 결과 데이터는 팀 학습 계획을 세우는 자료로도 사용할 수 있습니다.</p>
    </div>
  </aside>
  <section class="panel result" id="result" hidden>
    <div class="result__header">
      <h2>결과 요약</h2>
      <p id="summary-text">총 0문제 중 0문제를 맞혔어요.</p>
    </div>
    <div class="result__stats">
      <div>
        <span class="muted">획득 점수</span>
        <strong id="final">0</strong>
      </div>
      <div>
        <span class="muted">정답률</span>
        <strong id="accuracy">0%</strong>
      </div>
    </div>
    <div class="result__table">
      <table>
        <thead>
          <tr>
            <th>#</th>
            <th>문항</th>
            <th>선택한 답</th>
            <th>정답</th>
            <th>판정</th>
          </tr>
        </thead>
        <tbody id="tb"></tbody>
      </table>
    </div>
    <div class="result__actions">
      <button type="button" class="pill ghost" id="retry">처음부터</button>
      <button type="button" class="pill primary" id="review">오답만 다시 풀기</button>
    </div>
  </section>
</main>
<div class="overlay" id="intro">
  <div class="intro">
    <span class="eyebrow">Start</span>
    <h2>정책 이해도를 간단히 점검해 보세요</h2>
    <p>25초 안에 문항을 풀고 해설을 통해 최신 정책 포인트를 짚어봅니다. 준비되셨다면 아래 버튼을 눌러 시작해주세요.</p>
    <button type="button" class="pill primary intro__start" id="start">퀴즈 시작하기</button>
  </div>
</div>
<script>
const QUESTIONS = [
  {id:'q1',q:'정부24에서 제공하는 맞춤형 서비스 추천을 받으려면 어떤 절차가 필요할까요?',opts:['본인 인증 후 기본 정보 제공에 동의한다','주민센터 방문 신청을 완료한다','유료 프리미엄 회원에 가입한다','담당 공무원과 1:1 상담을 예약한다'],a:0,why:'맞춤형 추천은 본인 인증과 정보 제공 동의를 통해 이용자 프로필을 확인한 뒤 제공됩니다.'},
  {id:'q2',q:'디지털서비스 전문계약제도의 핵심 목적은 무엇인가요?',opts:['혁신 서비스 도입 시간을 단축하기 위해서','민간 기업의 참여를 제한하기 위해서','하드웨어 구매 비용을 낮추기 위해서','계약 과정에서 공개경쟁을 생략하기 위해서'],a:0,why:'전문계약제도는 검증된 서비스를 빠르게 도입해 공공 디지털 전환을 가속화하려는 제도입니다.'},
  {id:'q3',q:'공공데이터포털에서 데이터셋을 내려받아 분석하려 할 때 가장 범용적으로 활용할 수 있는 형식은 무엇인가요?',opts:['암호화된 PDF','매크로가 포함된 XLSM','CSV 또는 JSON','압축된 전용 포맷'],a:2,why:'CSV/JSON은 구조화된 데이터를 다양한 분석 도구와 연계하기에 가장 범용적인 개방형 형식입니다.'},
  {id:'q4',q:'공공데이터를 활용한 서비스를 기획할 때 가장 먼저 확인해야 하는 사항은 무엇인가요?',opts:['데이터 이용 약관과 라이선스 조건','서비스 브랜드 아이덴티티','홍보 영상 제작 여부','서버 증설 계획'],a:0,why:'데이터 이용 조건을 확인해야 활용 범위와 의무 사항을 파악해 안정적으로 서비스를 설계할 수 있습니다.'},
  {id:'q5',q:'국민비서(구삐) 서비스의 특징으로 옳은 것은 무엇인가요?',opts:['정책 일정을 맞춤형 알림으로 제공한다','민원 답변 초안을 자동으로 작성한다','정부24 전자문서만 보관한다','공공기관 내부 업무망에서만 이용 가능하다'],a:0,why:'국민비서는 이용자에게 필요한 정책·생활 알림을 맞춤형으로 제공하는 디지털 비서 서비스입니다.'},
  {id:'q6',q:'AI 기반 행정 서비스 설계 시 개인정보를 다룰 때 우선 적용해야 할 원칙은 무엇일까요?',opts:['서비스 고도화를 위해 최대한 많이 수집한다','사전 고지 없이 필요한 시점에 추가 수집한다','최소한으로 수집하고 목적에 맞게 활용한다','모든 데이터를 외부 클라우드에 위탁한다'],a:2,why:'개인정보는 목적 적합성과 최소 수집 원칙을 지켜야 하며 필요한 범위 내에서만 처리해야 합니다.'},
  {id:'q7',q:'디지털원패스는 어떤 서비스를 제공하나요?',opts:['하나의 인증으로 여러 공공 웹서비스를 이용하게 한다','온라인 민원 처리 속도를 자동으로 측정한다','모바일 신분증을 대신 발급해 준다','공공기관 인트라넷 접속 권한을 분배한다'],a:0,why:'디지털원패스는 하나의 ID로 여러 공공 서비스에 안전하게 로그인할 수 있게 하는 통합 인증 서비스입니다.'},
  {id:'q8',q:'온라인 민원 처리에서 답변 기한을 관리하기 위한 좋은 방법은 무엇인가요?',opts:['SLA를 설정하고 진행 현황을 시각화한다','외부 SNS에 처리 상황을 실시간 공유한다','모든 민원을 동일한 담당자에게 배정한다','기한 임박 시에만 수동으로 확인한다'],a:0,why:'SLA(서비스 수준 목표)를 설정하고 진행을 모니터링하면 기한 내 답변을 체계적으로 관리할 수 있습니다.'},
  {id:'q9',q:'공공 웹서비스가 접근성을 확보하고 있는지 점검할 때 우선 확인할 항목은 무엇인가요?',opts:['WCAG 기준에 맞춘 대체 텍스트와 대비율','사이트 색상 팔레트의 브랜드 일관성','접속자 수에 따른 서버 증설 계획','이벤트 페이지 수'],a:0,why:'웹접근성은 화면읽기 지원, 대비율, 대체 텍스트 등 WCAG 기준 준수 여부를 먼저 확인해야 합니다.'},
  {id:'q10',q:'행정서비스 개선을 위한 데이터 분석 프로젝트를 시작할 때 가장 효과적인 출발점은 무엇인가요?',opts:['문제 정의와 측정 지표를 명확히 합의한다','분석 도구의 최신 버전을 모두 설치한다','예산 전액을 외부 컨설턴트에 위탁한다','결과 보고서 템플릿부터 작성한다'],a:0,why:'분석은 해결하려는 행정 문제와 측정 지표를 명확히 정의해야 방향을 잃지 않고 인사이트를 낼 수 있습니다.'}
];
const DURATION = 25;
const $stage = document.getElementById('stage');
const $guide = document.getElementById('guide');
const $result = document.getElementById('result');
const $intro = document.getElementById('intro');
const $start = document.getElementById('start');
const $q = document.getElementById('q');
const $opts = document.getElementById('opts');
const $explain = document.getElementById('explain');
const $explainText = document.getElementById('explain-text');
const $score = document.getElementById('score');
const $idx = document.getElementById('idx');
const $total = document.getElementById('total');
const $progressText = document.getElementById('progress-text');
const $progressFill = document.getElementById('progress-fill');
const $time = document.getElementById('time');
const $ring = document.querySelector('.ring__fg');
const $next = document.getElementById('next');
const $skip = document.getElementById('skip');
const $final = document.getElementById('final');
const $accuracy = document.getElementById('accuracy');
const $summary = document.getElementById('summary-text');
const $tbody = document.getElementById('tb');
const $retry = document.getElementById('retry');
const $review = document.getElementById('review');
const $modeBadge = document.getElementById('mode-badge');

const state = {
  idx:0,
  score:0,
  seconds:DURATION,
  picked:null,
  locked:false,
  timer:null,
  answers:[],
  mode:'full'
};

let activeSet = QUESTIONS.slice();
let lastAnswers = [];
const CIRCUMFERENCE = 2 * Math.PI * 52;
$ring.style.strokeDasharray = CIRCUMFERENCE.toFixed(1);

function resetQuiz(subset = QUESTIONS, mode = 'full'){
  activeSet = subset.slice();
  state.idx = 0;
  state.score = 0;
  state.seconds = DURATION;
  state.picked = null;
  state.locked = false;
  state.answers = [];
  state.mode = mode;
  $modeBadge.textContent = mode === 'review' ? '오답 복습 모드' : '전체 모드';
  $modeBadge.classList.toggle('review', mode === 'review');
  $score.textContent = '0';
  $total.textContent = activeSet.length;
  $stage.hidden = false;
  $result.hidden = true;
  $intro.hidden = true;
  updateProgress();
  updateTime();
  render();
}

function render(){
  clearTimer();
  if(state.idx >= activeSet.length){
    finish();
    return;
  }
  const current = activeSet[state.idx];
  state.seconds = DURATION;
  state.picked = null;
  state.locked = false;
  $skip.disabled = false;
  $skip.textContent = '건너뛰기';
  $idx.textContent = state.idx + 1;
  $q.textContent = current.q;
  $opts.innerHTML = '';
  current.opts.forEach((text,index)=>{
    const btn = document.createElement('button');
    btn.type = 'button';
    btn.className = 'choice';
    btn.dataset.index = index;
    btn.innerHTML = `<span class="choice__index">${index+1}</span><span class="choice__text">${text}</span>`;
    btn.addEventListener('click',()=>selectOption(index));
    btn.addEventListener('keydown',(e)=>{
      if(e.key==='Enter' || e.key===' '){
        selectOption(index);
        e.preventDefault();
      }
    });
    $opts.appendChild(btn);
  });
  $explain.classList.remove('visible');
  $explain.setAttribute('aria-hidden','true');
  $explainText.textContent = '';
  $next.textContent = '정답 확인';
  updateProgress();
  updateTime();
  startTimer();
}

function selectOption(index){
  if(state.locked) return;
  state.picked = index;
  document.querySelectorAll('.choice').forEach(choice=>{
    const same = Number(choice.dataset.index) === index;
    choice.classList.toggle('selected', same);
  });
}

function startTimer(){
  clearTimer();
  state.timer = setInterval(()=>{
    state.seconds -= 1;
    updateTime();
    if(state.seconds <= 0){
      clearTimer();
      lock();
    }
  },1000);
}

function clearTimer(){
  if(state.timer){
    clearInterval(state.timer);
    state.timer = null;
  }
}

function updateTime(){
  const value = Math.max(state.seconds,0);
  $time.textContent = String(value).padStart(2,'0');
  updateRing(value);
}

function updateRing(remain){
  const ratio = Math.max(remain,0) / DURATION;
  const offset = CIRCUMFERENCE * (1 - Math.min(ratio,1));
  $ring.style.strokeDashoffset = offset.toFixed(1);
}

function updateProgress(){
  const total = activeSet.length || 1;
  const ratio = state.idx / total;
  $progressFill.style.width = (ratio * 100).toFixed(1) + '%';
  const displayIndex = Math.min(state.idx + 1, total);
  $progressText.textContent = `문제 ${displayIndex} / ${total}`;
}

function lock(){
  if(state.locked) return;
  state.locked = true;
  clearTimer();
  const current = activeSet[state.idx];
  const correct = state.picked === current.a;
  if(correct){
    state.score += 1;
    $score.textContent = state.score;
  }
  document.querySelectorAll('.choice').forEach(choice=>{
    const optionIndex = Number(choice.dataset.index);
    if(optionIndex === current.a){
      choice.classList.add('correct');
    }
    if(state.picked !== null && optionIndex === state.picked && optionIndex !== current.a){
      choice.classList.add('wrong');
    }
    choice.disabled = true;
  });
  $explain.classList.add('visible');
  $explain.setAttribute('aria-hidden','false');
  $explainText.textContent = current.why;
  $skip.disabled = true;
  const record = {
    id:current.id,
    question:current.q,
    options:current.opts.slice(),
    picked:state.picked,
    answer:current.a,
    correct
  };
  state.answers.push(record);
  if(state.idx === activeSet.length - 1){
    $next.textContent = '결과 보기';
  } else {
    $next.textContent = '다음 문제';
  }
}

function goNext(){
  if(!state.locked){
    lock();
    return;
  }
  if(state.idx < activeSet.length - 1){
    state.idx += 1;
    render();
  } else {
    finish();
  }
}

function finish(){
  clearTimer();
  $stage.hidden = true;
  $result.hidden = false;
  $progressFill.style.width = '100%';
  $progressText.textContent = '퀴즈 완료';
  const total = activeSet.length;
  const accuracy = total ? Math.round((state.score / total) * 100) : 0;
  $final.textContent = state.score;
  $accuracy.textContent = `${accuracy}%`;
  $summary.textContent = `총 ${total}문제 중 ${state.score}문제를 맞혔어요.`;
  $tbody.innerHTML = '';
  state.answers.forEach((row,index)=>{
    const tr = document.createElement('tr');
    tr.className = row.correct ? 'correct' : 'wrong';
    const pickedText = row.picked === null ? '-' : row.options[row.picked];
    const answerText = row.options[row.answer];
    tr.innerHTML = `<td>${index+1}</td><td>${row.question}</td><td>${pickedText}</td><td>${answerText}</td><td>${row.correct ? '정답' : '오답'}</td>`;
    $tbody.appendChild(tr);
  });
  lastAnswers = state.answers.map(item=>({...item}));
}

$next.addEventListener('click', goNext);
$skip.addEventListener('click', ()=>{
  if(state.locked) return;
  state.picked = null;
  lock();
});

$retry.addEventListener('click', ()=>{
  resetQuiz(QUESTIONS, 'full');
});

$review.addEventListener('click', ()=>{
  if(!lastAnswers.length){
    resetQuiz(QUESTIONS, 'full');
    return;
  }
  const wrong = lastAnswers.filter(item=>!item.correct);
  if(!wrong.length){
    alert('오답이 없습니다. 전체 모드로 다시 시작합니다.');
    resetQuiz(QUESTIONS, 'full');
    return;
  }
  const subset = wrong.map(item=>QUESTIONS.find(q=>q.id===item.id)).filter(Boolean);
  resetQuiz(subset, 'review');
});

$start.addEventListener('click', ()=>{
  resetQuiz(QUESTIONS, 'full');
});

document.addEventListener('keydown', (e)=>{
  if($intro.hidden === false){
    if(e.key === 'Enter' || e.key === ' '){
      e.preventDefault();
      resetQuiz(QUESTIONS, 'full');
    }
    return;
  }
  if($result.hidden === false){
    if(e.key === 'Enter'){
      e.preventDefault();
      resetQuiz(QUESTIONS, 'full');
    }
    return;
  }
  if(e.key === 'Enter'){
    e.preventDefault();
    goNext();
    return;
  }
  const mapping = {'1':0,'2':1,'3':2,'4':3};
  if(mapping[e.key] !== undefined){
    selectOption(mapping[e.key]);
  }
});

window.addEventListener('beforeunload', ()=>{
  clearTimer();
});
</script>
</body>
</html>







